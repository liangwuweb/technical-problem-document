# Push notification cannot show in "Building Progressive Web Apps" by Tal Ater

## The Problem
This document is an exploration of a problem I've met when following the "Building Progressive Web Apps" by Tal Ater. The problem is I cannot make the push notification to work on the app. According to the chapter 10 in the book, it supposes to ask user for permission after user clicks the making reservation button . If user grants the permission, the website will send a notification which contain the reservation details.(Figure 1)
<br/>
<br/>

<img align="left" src="imgs/notification-2.png"  alt="Notification firgue" width="410px" height="auto">
<img align="right" src="imgs/notification-1.png"  alt="Notification firgue" width="410px" height="auto">

<br clear="both"/>
<br />

*Firgue 1 The behavior of the ideal push notification*

## The Reason
After investigation, I found the reason is the subscription object generated by the server when user create a reservation. These reservatons contains a public key. This key will be matched with the private key store in our server. When I granted the permission last time, the server will store my subscription in the database. My subscriptions' public key might be outdated. So it cannot match with the private key. As a result, the notification cannot be pushed to user. Below is my investigation.

## The Investigation 

### The Process of Push Notification
Before even talking about my process of investigation, I want to first go through the procedure of push notifications.(BTW, we use push API in this book to create notifications). First of all, this process indluce two phases. In the first phase, our web page will use push API to create subscriptions and send it to the center messaging server which stores the details of the new subscription and returns it to our page. Then, our page will send the subscription details to our server where they can be stored for future use. In our app, the server's database will store this infomation. Time passes, it time to start the second phase which will send the notification messages from our server to the browser. When it's time to send the message, our server will utilize the details it sotered previouly and send them to the messaging sever. The message server will forward the message to the browser. Finally, our service worker will receives the message and decides what to do with it. 
